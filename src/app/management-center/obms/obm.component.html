<div class="app-obm">

  <inventory-header [allItems]="allObms" [name]="'OBM'"
    (action)="onAction($event)" (filter)="onFilter($event)">
  </inventory-header>

  <div class="inventory">
    <clr-datagrid [clrDgLoading]="dgDataLoading" [(clrDgSelected)]="selectedObms">
      <clr-dg-column [clrDgSortBy]="idComparator">ID</clr-dg-column>
      <clr-dg-column [clrDgSortBy]="nodeComparator">Node
        <clr-dg-string-filter [clrDgStringFilter]="nodeFilter">
        </clr-dg-string-filter>
      </clr-dg-column>
      <clr-dg-column [clrDgSortBy]="serviceComparator">Service
        <clr-dg-string-filter [clrDgStringFilter]="serviceFilter">
        </clr-dg-string-filter>
      </clr-dg-column>
      <clr-dg-column [clrDgSortBy]="configComparator">Config</clr-dg-column>

      <clr-dg-row *clrDgItems="let obm of obmStore" [clrDgItem]="obm">
        <clr-dg-cell>{{obm.id}}</clr-dg-cell>
        <clr-dg-cell>{{obm.node.split('/')[4]}}</clr-dg-cell>
        <clr-dg-cell>{{obm.service}}</clr-dg-cell>
        <!-- <clr-dg-cell>{{obm.config | json}}</clr-dg-cell> -->
        <clr-dg-cell (click)="getChild('config', obm)">
          <u class="grid-item">Config</u>
        </clr-dg-cell>
        <clr-dg-action-overflow>
          <button class="action-item" (click)="onUpdate(obm)">Update</button>
          <button class="action-item" (click)="willDelete(obm)">Delete</button>
          <button class="action-item" (click)="goToDetail(obm)">Details</button>
        </clr-dg-action-overflow>

      </clr-dg-row>
      <clr-dg-footer>
        <inventory-footer></inventory-footer>
      </clr-dg-footer>
    </clr-datagrid>

    <div class="selected">
      Selected OBMs:
      <span *ngFor="let obm of selectedObms; let isLast = last">
        {{obm? obm.id : null}}{{isLast ? '' : ', '}}
      </span>
    </div>
  </div>

  <details-modal [(isPop)]="isShowDetail" [data]="selectedObm"
    [title]="'OBM ' + (selectedObm && selectedObm.id)">
  </details-modal>

  <details-modal [(isPop)]="isShowModal" [data]="rawData"
    [dataType]="action" [title]="'OBM ' + (selectedObm && selectedObm.id)">
  </details-modal>

  <clr-modal [(clrModalOpen)]="isCreateObm" [clrModalSize]="'md'">
    <h3 class="modal-title">Create OBM</h3>
    <div class="modal-body">
      <form [formGroup]="obmForm" novalidate>
        <section class="form-block">
          <div class="form-group">
            <label for="selects_2">NodeId</label>
            <div class="select">
              <select id="selects_2" formControlName="nodeId">
                <option selected hidden></option>
                <option *ngFor="let node of allNodes;">{{ node.id }}</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="serviceField">Service</label>
            <div class="select">
              <select id="serviceField" formControlName="service" (change)="onServiceSelected()">
                <option selected hidden></option>
                <option *ngFor="let service of obmTypes;">{{ service }}</option>
              </select>
            </div>
          </div>

          <div *ngIf="selObmService">
            <div *ngFor="let field of configFields" class="form-group">
              <label [for]="'id_' + field">{{field | titlecase}}</label>
              <input type="text" [id]="'id_' + field" [formControlName]="field"
                [placeholder]="selObmService && selObmService.config[field].default || '[]'">
            </div>
          </div>

        </section>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline" (click)="closeUpsertModal()">Cancel</button>
      <button type="button" class="btn btn-primary" (click)="onUpsert();closeUpsertModal()"
        [disabled]="obmForm.invalid">OK</button>
    </div>
  </clr-modal>

  <confirm-modal [(isPop)]="isDelete" title="OBMs"
    (confirm)="onConfirm($event)" [data]="selectedObms">
  </confirm-modal>

</div>
